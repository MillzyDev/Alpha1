#include "il2cpp.hpp"
#include "logger.hpp"

#define STR_WRAP(k) STR_WRAP_INNER(k)
#define STR_WRAP_INNER(k) #k

#define GAME_ASSEMBLY(name) HMODULE game_assembly = LoadLibraryA(name)
#define LOAD_IL2CPP_FUNC(name) \
    ::alpha1::il2cpp::name = reinterpret_cast<il2cpp_##name##_t>(GetProcAddress(game_assembly, STR_WRAP(il2cpp_##name)))

namespace alpha1 {
    void load_il2cpp_funcs(::alpha1::logger &logger) {
        il2cpp::init_il2cpp();
        logger.info("Loaded all IL2CPP functions.");
    }

    void il2cpp::init_il2cpp() {
        // TODO: Error handling
        GAME_ASSEMBLY("GameAssembly.dll");

        LOAD_IL2CPP_FUNC(init);
        LOAD_IL2CPP_FUNC(init_utf16);
        LOAD_IL2CPP_FUNC(shutdown);
        LOAD_IL2CPP_FUNC(set_config_dir);
        LOAD_IL2CPP_FUNC(set_data_dir);
        LOAD_IL2CPP_FUNC(set_temp_dir);
        LOAD_IL2CPP_FUNC(set_commandline_arguments);
        LOAD_IL2CPP_FUNC(set_commandline_arguments_utf16);
        LOAD_IL2CPP_FUNC(set_config_utf16);
        LOAD_IL2CPP_FUNC(set_config);
        LOAD_IL2CPP_FUNC(set_memory_callbacks);
        LOAD_IL2CPP_FUNC(get_corlib);
        LOAD_IL2CPP_FUNC(add_internal_call);
        LOAD_IL2CPP_FUNC(resolve_icall);
        LOAD_IL2CPP_FUNC(alloc);
        LOAD_IL2CPP_FUNC(free);
        LOAD_IL2CPP_FUNC(array_class_get);
        LOAD_IL2CPP_FUNC(array_length);
        LOAD_IL2CPP_FUNC(array_get_byte_length);
        LOAD_IL2CPP_FUNC(array_new);
        LOAD_IL2CPP_FUNC(array_new_specific);
        LOAD_IL2CPP_FUNC(bounded_array_class_get);
        LOAD_IL2CPP_FUNC(array_element_size);
        LOAD_IL2CPP_FUNC(assembly_get_image);
        LOAD_IL2CPP_FUNC(class_for_each);
        LOAD_IL2CPP_FUNC(class_enum_basetype);
        LOAD_IL2CPP_FUNC(class_is_generic);
        LOAD_IL2CPP_FUNC(class_is_inflated);
        LOAD_IL2CPP_FUNC(class_is_assignable_from);
        LOAD_IL2CPP_FUNC(class_is_subclass_of);
        LOAD_IL2CPP_FUNC(class_has_parent);
        LOAD_IL2CPP_FUNC(class_from_il2cpp_type);
        LOAD_IL2CPP_FUNC(class_from_name);
        LOAD_IL2CPP_FUNC(class_from_system_type);
        LOAD_IL2CPP_FUNC(class_get_element_class);
        LOAD_IL2CPP_FUNC(class_get_events);
        LOAD_IL2CPP_FUNC(class_get_fields);
        LOAD_IL2CPP_FUNC(class_get_nested_types);
        LOAD_IL2CPP_FUNC(class_get_interfaces);
        LOAD_IL2CPP_FUNC(class_get_properties);
        LOAD_IL2CPP_FUNC(class_get_property_from_name);
        LOAD_IL2CPP_FUNC(class_get_field_from_name);
        LOAD_IL2CPP_FUNC(class_get_methods);
        LOAD_IL2CPP_FUNC(class_get_method_from_name);
        LOAD_IL2CPP_FUNC(class_get_name);
        LOAD_IL2CPP_FUNC(type_get_name_chunked);
        LOAD_IL2CPP_FUNC(class_get_namespace);
        LOAD_IL2CPP_FUNC(class_get_parent);
        LOAD_IL2CPP_FUNC(class_get_declaring_type);
        LOAD_IL2CPP_FUNC(class_instance_size);
        LOAD_IL2CPP_FUNC(class_num_fields);
        LOAD_IL2CPP_FUNC(class_is_valuetype);
        LOAD_IL2CPP_FUNC(class_value_size);
        LOAD_IL2CPP_FUNC(class_is_blittable);
        LOAD_IL2CPP_FUNC(class_get_flags);
        LOAD_IL2CPP_FUNC(class_is_abstract);
        LOAD_IL2CPP_FUNC(class_is_interface);
        LOAD_IL2CPP_FUNC(class_array_element_size);
        LOAD_IL2CPP_FUNC(class_from_type);
        LOAD_IL2CPP_FUNC(class_get_type);
        LOAD_IL2CPP_FUNC(class_get_type_token);
        LOAD_IL2CPP_FUNC(class_has_attribute);
        LOAD_IL2CPP_FUNC(class_has_references);
        LOAD_IL2CPP_FUNC(class_is_enum);
        LOAD_IL2CPP_FUNC(class_get_image);
        LOAD_IL2CPP_FUNC(class_get_assemblyname);
        LOAD_IL2CPP_FUNC(class_get_rank);
        LOAD_IL2CPP_FUNC(class_get_data_size);
        LOAD_IL2CPP_FUNC(class_get_static_field_data);
        LOAD_IL2CPP_FUNC(class_get_bitmap_size);
        LOAD_IL2CPP_FUNC(class_get_bitmap);
        LOAD_IL2CPP_FUNC(stats_dump_to_file);
        LOAD_IL2CPP_FUNC(stats_get_value);
        LOAD_IL2CPP_FUNC(domain_get);
        LOAD_IL2CPP_FUNC(domain_assembly_open);
        LOAD_IL2CPP_FUNC(domain_get_assemblies);
        LOAD_IL2CPP_FUNC(raise_exception);
        LOAD_IL2CPP_FUNC(exception_from_name_msg);
        LOAD_IL2CPP_FUNC(get_exception_argument_null);
        LOAD_IL2CPP_FUNC(format_exception);
        LOAD_IL2CPP_FUNC(format_stack_trace);
        LOAD_IL2CPP_FUNC(unhandled_exception);
        LOAD_IL2CPP_FUNC(native_stack_trace);
        LOAD_IL2CPP_FUNC(field_get_flags);
        LOAD_IL2CPP_FUNC(field_get_name);
        LOAD_IL2CPP_FUNC(field_get_parent);
        LOAD_IL2CPP_FUNC(field_get_offset);
        LOAD_IL2CPP_FUNC(field_get_type);
        LOAD_IL2CPP_FUNC(field_get_value);
        LOAD_IL2CPP_FUNC(field_get_value_object);
        LOAD_IL2CPP_FUNC(field_has_attribute);
        LOAD_IL2CPP_FUNC(field_set_value);
        LOAD_IL2CPP_FUNC(field_static_get_value);
        LOAD_IL2CPP_FUNC(field_static_set_value);
        LOAD_IL2CPP_FUNC(field_set_value_object);
        LOAD_IL2CPP_FUNC(field_is_literal);
        LOAD_IL2CPP_FUNC(gc_collect);
        LOAD_IL2CPP_FUNC(gc_collect_a_little);
        LOAD_IL2CPP_FUNC(gc_start_incremental_collection);
        LOAD_IL2CPP_FUNC(gc_disable);
        LOAD_IL2CPP_FUNC(gc_enable);
        LOAD_IL2CPP_FUNC(gc_is_disabled);
        LOAD_IL2CPP_FUNC(gc_set_mode);
        LOAD_IL2CPP_FUNC(gc_get_max_time_slice_ns);
        LOAD_IL2CPP_FUNC(gc_set_max_time_slice_ns);
        LOAD_IL2CPP_FUNC(gc_is_incremental);
        LOAD_IL2CPP_FUNC(gc_get_used_size);
        LOAD_IL2CPP_FUNC(gc_get_heap_size);
        LOAD_IL2CPP_FUNC(gc_wbarrier_set_field);
        LOAD_IL2CPP_FUNC(gc_has_strict_wbarriers);
        LOAD_IL2CPP_FUNC(gc_set_external_allocation_tracker);
        LOAD_IL2CPP_FUNC(gc_set_external_wbarrier_tracker);
        LOAD_IL2CPP_FUNC(gc_foreach_heap);
        LOAD_IL2CPP_FUNC(stop_gc_world);
        LOAD_IL2CPP_FUNC(start_gc_world);
        LOAD_IL2CPP_FUNC(gc_alloc_fixed);
        LOAD_IL2CPP_FUNC(gc_free_fixed);
        LOAD_IL2CPP_FUNC(gchandle_new);
        LOAD_IL2CPP_FUNC(gchandle_new_weakref);
        LOAD_IL2CPP_FUNC(gchandle_get_target);
        LOAD_IL2CPP_FUNC(gchandle_free);
        LOAD_IL2CPP_FUNC(gchandle_foreach_get_target);
        LOAD_IL2CPP_FUNC(object_header_size);
        LOAD_IL2CPP_FUNC(array_object_header_size);
        LOAD_IL2CPP_FUNC(offset_of_array_length_in_array_object_header);
        LOAD_IL2CPP_FUNC(offset_of_array_bounds_in_array_object_header);
        LOAD_IL2CPP_FUNC(allocation_granularity);
        LOAD_IL2CPP_FUNC(unity_liveness_allocate_struct);
        LOAD_IL2CPP_FUNC(unity_liveness_calculation_from_root);
        LOAD_IL2CPP_FUNC(unity_liveness_calculation_from_statics);
        LOAD_IL2CPP_FUNC(unity_liveness_finalize);
        LOAD_IL2CPP_FUNC(unity_liveness_free_struct);
        LOAD_IL2CPP_FUNC(method_get_return_type);
        LOAD_IL2CPP_FUNC(method_get_declaring_type);
        LOAD_IL2CPP_FUNC(method_get_name);
        LOAD_IL2CPP_FUNC(method_get_from_reflection);
        LOAD_IL2CPP_FUNC(method_get_object);
        LOAD_IL2CPP_FUNC(method_is_generic);
        LOAD_IL2CPP_FUNC(method_is_inflated);
        LOAD_IL2CPP_FUNC(method_is_instance);
        LOAD_IL2CPP_FUNC(method_get_param_count);
        LOAD_IL2CPP_FUNC(method_get_class);
        LOAD_IL2CPP_FUNC(method_has_attribute);
        LOAD_IL2CPP_FUNC(method_get_flags);
        LOAD_IL2CPP_FUNC(method_get_token);
        LOAD_IL2CPP_FUNC(method_get_param_name);
        LOAD_IL2CPP_FUNC(profiler_install);
        LOAD_IL2CPP_FUNC(profiler_set_events);
        LOAD_IL2CPP_FUNC(profiler_install_enter_leave);
        LOAD_IL2CPP_FUNC(profiler_install_allocation);
        LOAD_IL2CPP_FUNC(profiler_install_gc);
        LOAD_IL2CPP_FUNC(profiler_install_fileio);
        LOAD_IL2CPP_FUNC(profiler_install_thread);
        LOAD_IL2CPP_FUNC(property_get_flags);
        LOAD_IL2CPP_FUNC(property_get_get_method);
        LOAD_IL2CPP_FUNC(property_get_set_method);
        LOAD_IL2CPP_FUNC(property_get_name);
        LOAD_IL2CPP_FUNC(property_get_parent);
        LOAD_IL2CPP_FUNC(object_get_class);
        LOAD_IL2CPP_FUNC(object_get_size);
        LOAD_IL2CPP_FUNC(object_get_virtual_method);
        LOAD_IL2CPP_FUNC(object_new);
        LOAD_IL2CPP_FUNC(object_unbox);
        LOAD_IL2CPP_FUNC(value_box);
        LOAD_IL2CPP_FUNC(monitor_enter);
        LOAD_IL2CPP_FUNC(monitor_try_enter);
        LOAD_IL2CPP_FUNC(monitor_exit);
        LOAD_IL2CPP_FUNC(monitor_pulse);
        LOAD_IL2CPP_FUNC(monitor_pulse_all);
        LOAD_IL2CPP_FUNC(monitor_wait);
        LOAD_IL2CPP_FUNC(monitor_try_wait);
        LOAD_IL2CPP_FUNC(runtime_invoke);
        LOAD_IL2CPP_FUNC(runtime_invoke_convert_args);
        LOAD_IL2CPP_FUNC(runtime_class_init);
        LOAD_IL2CPP_FUNC(runtime_object_init);
        LOAD_IL2CPP_FUNC(runtime_object_init_exception);
        LOAD_IL2CPP_FUNC(runtime_unhandled_exception_policy_set);
        LOAD_IL2CPP_FUNC(string_length);
        LOAD_IL2CPP_FUNC(string_chars);
        LOAD_IL2CPP_FUNC(string_new);
        LOAD_IL2CPP_FUNC(string_new_len);
        LOAD_IL2CPP_FUNC(string_new_utf16);
        LOAD_IL2CPP_FUNC(string_new_wrapper);
        LOAD_IL2CPP_FUNC(string_intern);
        LOAD_IL2CPP_FUNC(string_is_interned);
        LOAD_IL2CPP_FUNC(thread_current);
        LOAD_IL2CPP_FUNC(thread_attach);
        LOAD_IL2CPP_FUNC(thread_detach);
        LOAD_IL2CPP_FUNC(thread_get_all_attached_threads);
        LOAD_IL2CPP_FUNC(is_vm_thread);
        LOAD_IL2CPP_FUNC(current_thread_walk_frame_stack);
        LOAD_IL2CPP_FUNC(thread_walk_frame_stack);
        LOAD_IL2CPP_FUNC(current_thread_get_top_frame);
        LOAD_IL2CPP_FUNC(thread_get_top_frame);
        LOAD_IL2CPP_FUNC(current_thread_get_frame_at);
        LOAD_IL2CPP_FUNC(thread_get_frame_at);
        LOAD_IL2CPP_FUNC(current_thread_get_stack_depth);
        LOAD_IL2CPP_FUNC(thread_get_stack_depth);
        LOAD_IL2CPP_FUNC(override_stack_backtrace);
        LOAD_IL2CPP_FUNC(type_get_object);
        LOAD_IL2CPP_FUNC(type_get_type);
        LOAD_IL2CPP_FUNC(type_get_class_or_element_class);
        LOAD_IL2CPP_FUNC(type_get_name);
        LOAD_IL2CPP_FUNC(type_is_byref);
        LOAD_IL2CPP_FUNC(type_get_attrs);
        LOAD_IL2CPP_FUNC(type_equals);
        LOAD_IL2CPP_FUNC(type_get_assembly_qualified_name);
        LOAD_IL2CPP_FUNC(type_is_static);
        LOAD_IL2CPP_FUNC(type_is_pointer_type);
        LOAD_IL2CPP_FUNC(image_get_assembly);
        LOAD_IL2CPP_FUNC(image_get_name);
        LOAD_IL2CPP_FUNC(image_get_filename);
        LOAD_IL2CPP_FUNC(image_get_entry_point);
        LOAD_IL2CPP_FUNC(image_get_class_count);
        LOAD_IL2CPP_FUNC(image_get_class);
        LOAD_IL2CPP_FUNC(capture_memory_snapshot);
        LOAD_IL2CPP_FUNC(free_captured_memory_snapshot);
        LOAD_IL2CPP_FUNC(set_find_plugin_callback);
        LOAD_IL2CPP_FUNC(register_log_callback);
        LOAD_IL2CPP_FUNC(debugger_set_agent_options);
        LOAD_IL2CPP_FUNC(is_debugger_attached);
        LOAD_IL2CPP_FUNC(register_debugger_agent_transport);
        LOAD_IL2CPP_FUNC(debug_get_method_info);
        LOAD_IL2CPP_FUNC(unity_install_unitytls_interface);
        LOAD_IL2CPP_FUNC(custom_attrs_from_class);
        LOAD_IL2CPP_FUNC(custom_attrs_from_method);
        LOAD_IL2CPP_FUNC(custom_attrs_get_attr);
        LOAD_IL2CPP_FUNC(custom_attrs_has_attr);
        LOAD_IL2CPP_FUNC(custom_attrs_construct);
        LOAD_IL2CPP_FUNC(class_set_userdata);
        LOAD_IL2CPP_FUNC(class_get_userdata_offset);
        LOAD_IL2CPP_FUNC(set_default_thread_affinity);
    }
}